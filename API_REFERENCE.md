
# Interior Design API Reference

## Edge Function: `generate-interior-design`

### Endpoint
```
POST https://your-project.supabase.co/functions/v1/generate-interior-design
```

### Authentication
Requires a valid Supabase authentication token in the Authorization header:
```
Authorization: Bearer <your-supabase-auth-token>
```

### Request Format
Content-Type: `multipart/form-data`

#### Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `image` | File | Yes | The interior space image to transform (JPEG, PNG) |
| `designTool` | String | Yes | The design tool to apply: `wall-color`, `furniture`, `lighting`, or `flooring` |
| `customPrompt` | String | No | Custom prompt to override the default tool prompt |

### Response Format

#### Success Response (200 OK)
```json
{
  "url": "https://your-project.supabase.co/storage/v1/object/public/generated-designs/user-id/timestamp-tool-uuid.png",
  "path": "user-id/timestamp-tool-uuid.png",
  "designTool": "wall-color",
  "duration_ms": 15234,
  "width": 1024,
  "height": 1024
}
```

#### Error Responses

**401 Unauthorized**
```json
{
  "error": "Unauthorized"
}
```

**400 Bad Request**
```json
{
  "error": "Image file is required"
}
```
or
```json
{
  "error": "Design tool selection is required"
}
```

**502 Bad Gateway**
```json
{
  "error": "No image generated by AI",
  "message": "The AI did not return an image. Please try again."
}
```

**500 Internal Server Error**
```json
{
  "error": "Internal server error",
  "detail": "Error details here"
}
```

## Design Tools

### wall-color
Transforms the interior space by changing wall colors to modern, elegant tones while keeping furniture and layout the same.

**Default Prompt:**
> "Transform this interior space by changing the wall colors to modern, elegant tones. Keep the furniture and layout the same, but reimagine the walls with sophisticated paint colors and textures that enhance the room's ambiance."

### furniture
Redesigns the space with modern, stylish furniture arrangements.

**Default Prompt:**
> "Redesign this interior space with modern, stylish furniture arrangements. Replace or rearrange the furniture to create a more functional and aesthetically pleasing layout while maintaining the room's structure."

### lighting
Enhances the space with improved lighting design and fixtures.

**Default Prompt:**
> "Enhance this interior space with improved lighting design. Add modern light fixtures, adjust natural lighting, and create a warm, inviting atmosphere through strategic lighting placement."

### flooring
Transforms the space by changing the flooring material.

**Default Prompt:**
> "Transform this interior space by changing the flooring material. Replace the current floor with modern materials like hardwood, tile, or luxury vinyl that complement the room's style."

## React Hook: `useInteriorDesign`

### Import
```typescript
import { useInteriorDesign } from '@/hooks/useInteriorDesign';
```

### Usage
```typescript
const { generate, loading, error, data, reset, abort } = useInteriorDesign();

// Generate a design
const result = await generate({
  imageUri: 'file:///path/to/image.jpg',
  designTool: 'wall-color',
  customPrompt: 'Optional custom prompt', // optional
});
```

### Hook API

#### `generate(params: InteriorDesignParams): Promise<InteriorDesignResult | null>`
Generates an interior design transformation.

**Parameters:**
```typescript
type InteriorDesignParams = {
  imageUri: string;           // Local file URI of the image
  imageName?: string;         // Optional filename
  imageType?: string;         // Optional MIME type
  designTool: DesignTool;     // 'wall-color' | 'furniture' | 'lighting' | 'flooring'
  customPrompt?: string;      // Optional custom prompt
};
```

**Returns:**
```typescript
type InteriorDesignResult = {
  url: string;          // Public URL of generated image
  path: string;         // Storage path
  designTool: string;   // Tool used
  duration_ms: number;  // Generation time in milliseconds
  width: number;        // Image width
  height: number;       // Image height
} | null;
```

#### `loading: boolean`
True when a generation is in progress.

#### `error: string | null`
Error message if generation failed, null otherwise.

#### `data: InteriorDesignResult | null`
The result of the last successful generation, null otherwise.

#### `reset(): void`
Resets the hook state to idle.

#### `abort(): void`
Aborts the current generation request.

## Example Usage

### Basic Example
```typescript
import { useInteriorDesign } from '@/hooks/useInteriorDesign';

function MyComponent() {
  const { generate, loading, error, data } = useInteriorDesign();

  const handleGenerate = async () => {
    const result = await generate({
      imageUri: 'file:///path/to/room.jpg',
      designTool: 'wall-color',
    });

    if (result) {
      console.log('Generated image URL:', result.url);
    }
  };

  return (
    <View>
      <Button onPress={handleGenerate} disabled={loading}>
        {loading ? 'Generating...' : 'Generate Design'}
      </Button>
      {error && <Text>Error: {error}</Text>}
      {data && <Image source={{ uri: data.url }} />}
    </View>
  );
}
```

### With Custom Prompt
```typescript
const result = await generate({
  imageUri: imageUri,
  designTool: 'furniture',
  customPrompt: 'Add modern Scandinavian furniture with light wood tones and minimalist design',
});
```

### With Error Handling
```typescript
const handleGenerate = async () => {
  try {
    const result = await generate({
      imageUri: imageUri,
      designTool: selectedTool,
    });

    if (result) {
      Alert.alert('Success', `Design generated in ${result.duration_ms / 1000}s`);
    } else if (error) {
      Alert.alert('Error', error);
    }
  } catch (err) {
    console.error('Unexpected error:', err);
  }
};
```

## Performance Considerations

- **Generation Time**: Typically 10-30 seconds depending on image complexity
- **Image Size**: Gemini returns 1024x1024 images
- **Rate Limits**: Gemini free tier allows 15 requests per minute
- **Storage**: Each generated image is ~500KB-2MB

## Best Practices

1. **Show Loading State**: Always display a loading indicator during generation
2. **Handle Errors Gracefully**: Provide clear error messages to users
3. **Validate Images**: Ensure images are valid before sending to API
4. **Optimize Images**: Consider compressing images before upload
5. **Cache Results**: Store generated images locally to avoid regeneration
6. **Implement Retry Logic**: Handle temporary failures with retry mechanism
7. **Monitor Usage**: Track API calls to stay within rate limits

## Limitations

- Maximum image size: 10MB (recommended: < 5MB)
- Supported formats: JPEG, PNG
- Generation time: 10-30 seconds
- Rate limits apply (see Gemini API documentation)
- Requires active internet connection
- Requires valid Supabase authentication

---

For more information, see the [Setup Instructions](SETUP_INSTRUCTIONS.md).
